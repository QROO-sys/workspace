(()=>{var e={};e.id=850,e.ids=[850],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6701:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.Z,__next_app__:()=>u,originalPathname:()=>c,pages:()=>d,routeModule:()=>m,tree:()=>l}),s(5141),s(2697),s(5079),s(5866);var r=s(3191),a=s(8716),n=s(3315),o=s(5231),i={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);s.d(t,i);let l=["",{children:["owner",{children:["bookings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,5141)),"/Users/fuuentes/workspace/qroo_final/workspace/frontend/src/app/owner/bookings/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2697)),"/Users/fuuentes/workspace/qroo_final/workspace/frontend/src/app/owner/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,5079)),"/Users/fuuentes/workspace/qroo_final/workspace/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/fuuentes/workspace/qroo_final/workspace/frontend/src/app/owner/bookings/page.tsx"],c="/owner/bookings/page",u={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/owner/bookings/page",pathname:"/owner/bookings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},1320:(e,t,s)=>{Promise.resolve().then(s.bind(s,6479))},6479:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var r=s(326),a=s(7577),n=s(8069);function o(e){return String(e).padStart(2,"0")}function i(e){return String(e).padStart(3,"0")}function l(e){return`${e.getFullYear()}-${o(e.getMonth()+1)}-${o(e.getDate())}`}function d(e){return Number.isFinite(new Date(e).getTime())}function c(e){let t=new Date(e).getTime();return Number.isFinite(t)?t:0}function u(){let[e,t]=(0,a.useState)(!0),[s,u]=(0,a.useState)(null),[m,p]=(0,a.useState)([]),[x,h]=(0,a.useState)([]),[g,b]=(0,a.useState)([]),[f,N]=(0,a.useState)(!1),[y,k]=(0,a.useState)(""),[S,j]=(0,a.useState)(""),[v,w]=(0,a.useState)(()=>l(new Date)),[A,P]=(0,a.useState)(9),[C,D]=(0,a.useState)(1),[_,I]=(0,a.useState)(""),[E,T]=(0,a.useState)(""),[$,O]=(0,a.useState)(!1),[q,U]=(0,a.useState)(null),[B,G]=(0,a.useState)(null),M=(0,a.useMemo)(()=>{let e=[];for(let t=9;t<=16;t++)e.push(t);return e},[]);async function F(){u(null),t(!0);try{let[e,t,s]=await Promise.all([(0,n.S)("/desks",{method:"GET"}),(0,n.S)("/bookings",{method:"GET"}).catch(()=>[]),(0,n.S)("/sessions/active",{method:"GET"}).catch(()=>({sessions:[]}))]),r=Array.isArray(e)?e:e?.desks,a=Array.isArray(t)?t:t?.bookings,o=Array.isArray(s?.sessions)?s.sessions:[],l=Array.isArray(r)?r.map((e,t)=>({id:String(e?.id??e?._id??""),name:String(e?.name??`Desk ${t+1}`),laptopSerial:String(e?.laptopSerial??e?.serial??`LAP-${i(t+1)}`)})):[],d=[];for(let e=0;e<10;e++){let t=l[e];t&&t.id?d.push({id:t.id,name:t.name||`Desk ${e+1}`,laptopSerial:t.laptopSerial||`LAP-${i(e+1)}`}):d.push({id:`placeholder-desk-${e+1}`,name:`Desk ${e+1}`,laptopSerial:`LAP-${i(e+1)}`,isPlaceholder:!0})}let c=Array.isArray(a)?a.map(e=>({id:String(e?.id??e?._id??""),tableId:String(e?.tableId??e?.deskId??e?.table?.id??e?.desk?.id??""),startAt:String(e?.startAt??e?.startTime??e?.start??e?.from??""),endAt:String(e?.endAt??e?.endTime??e?.end??e?.to??""),status:String(e?.status??""),customerName:String(e?.customerName??e?.customer??""),customerPhone:String(e?.customerPhone??e?.phone??"")})):[];p(d),h(c),b(o),l.length||u("No desks returned from /desks. Make sure you're logged in and desks are seeded for your tenant.")}catch(e){u(e?.message||"Failed to load bookings page data")}finally{t(!1)}}let L=(0,a.useMemo)(()=>{let e=new Set;for(let t of g){let s=String(t?.deskId||t?.tableId||"");s&&e.add(s)}return e},[g]),R=(0,a.useMemo)(()=>{let e=Date.now(),t=new Map;for(let s of x){if(!s.tableId||!d(s.startAt)||!d(s.endAt)||c(s.endAt)<e)continue;let r=t.get(s.tableId)||[];r.push(s),t.set(s.tableId,r)}for(let[e,s]of t.entries())s.sort((e,t)=>c(e.startAt)-c(t.startAt)),t.set(e,s);return t},[x]);async function H(){if(U(null),G(null),!y)return U("No desk selected.");let e=m.find(e=>e.id===y);if(e?.isPlaceholder)return U("Cannot book a placeholder desk. Seed desks in DB first.");if(L.has(y))return U("Desk is currently in session. End session first.");if(!_.trim()||!E.trim())return U("Customer name and phone are required for bookings.");if(!Number.isFinite(C)||C<1||C>8)return U("Hours must be between 1 and 8.");if(!Number.isFinite(A)||A<9||A>16)return U("Start hour must be between 09:00 and 16:00.");if(A+C>17)return U("Booking must end by 17:00.");let t=new Date(`${v}T${o(A)}:00:00`).toISOString(),s=new Date(`${v}T${o(A+C)}:00:00`).toISOString();if((R.get(y)||[]).some(e=>{if(!d(e.startAt)||!d(e.endAt))return!1;let r=c(e.startAt),a=c(e.endAt),n=c(t),o=c(s);return n<a&&o>r}))return U("This time overlaps an existing booking for that desk.");O(!0);try{await (0,n.S)("/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableId:y,startAt:t,endAt:s,customerName:_.trim(),customerPhone:E.trim()})}),G("Booking created."),await F()}catch(e){U(e?.message||"Booking failed")}finally{O(!1)}}return e?r.jsx("div",{className:"text-sm text-gray-600",children:"Loading bookings…"}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-2xl font-bold",children:"Bookings"}),r.jsx("div",{className:"text-sm text-gray-600",children:"Book by desk. Desks in session can’t be booked."})]}),r.jsx("button",{className:"rounded border px-3 py-2 text-sm hover:bg-gray-50",onClick:F,type:"button",children:"Refresh"})]}),s&&r.jsx("div",{className:"rounded border bg-red-50 p-3 text-sm text-red-800 border-red-200",children:s}),r.jsx("div",{className:"overflow-auto rounded border bg-white",children:(0,r.jsxs)("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{className:"text-left border-b",children:[r.jsx("th",{className:"py-2 px-3",children:"Desk"}),r.jsx("th",{className:"py-2 px-3",children:"Laptop"}),r.jsx("th",{className:"py-2 px-3",children:"Status"}),r.jsx("th",{className:"py-2 px-3",children:"Next booking"}),r.jsx("th",{className:"py-2 px-3",children:"Action"})]})}),r.jsx("tbody",{children:m.map(e=>{let t=e.isPlaceholder?"UNCONFIGURED":L.has(e.id)?"IN SESSION":R.get(e.id)?.[0]?"BOOKED":"OPEN",s=e.isPlaceholder?null:R.get(e.id)?.[0],a="IN SESSION"===t||"UNCONFIGURED"===t;return(0,r.jsxs)("tr",{className:"border-b last:border-b-0 align-top",children:[r.jsx("td",{className:"py-2 px-3 font-medium",children:e.name}),r.jsx("td",{className:"py-2 px-3",children:e.laptopSerial}),r.jsx("td",{className:"py-2 px-3",children:r.jsx("span",{className:"inline-flex rounded px-2 py-1 text-xs border bg-gray-50 border-gray-200",children:t})}),r.jsx("td",{className:"py-2 px-3",children:s?(0,r.jsxs)("div",{className:"text-xs",children:[(0,r.jsxs)("div",{children:[s.startAt," → ",s.endAt]}),(0,r.jsxs)("div",{className:"text-gray-600",children:[s.customerName," ",s.customerPhone?`(${s.customerPhone})`:""]})]}):r.jsx("span",{className:"text-gray-600",children:"None"})}),(0,r.jsxs)("td",{className:"py-2 px-3",children:[r.jsx("button",{className:"rounded border px-3 py-2 text-sm hover:bg-gray-50 disabled:opacity-60",disabled:a,onClick:()=>(function(e){if(U(null),G(null),e.isPlaceholder){U("This desk is not configured in the database yet (placeholder)."),N(!0),k(e.id),j(e.name);return}k(e.id),j(e.name),w(l(new Date)),P(9),D(1),I(""),T(""),N(!0)})(e),type:"button",children:"Book"}),a&&"UNCONFIGURED"===t&&r.jsx("div",{className:"text-[11px] text-gray-500 mt-1",children:"Seed desks in DB"}),a&&"IN SESSION"===t&&r.jsx("div",{className:"text-[11px] text-gray-500 mt-1",children:"End session first"})]})]},e.id)})})]})}),f&&(0,r.jsxs)("div",{className:"rounded border bg-white p-4 space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"font-semibold",children:["Create booking — ",S]}),r.jsx("button",{className:"rounded border px-3 py-2 text-sm hover:bg-gray-50",onClick:function(){N(!1),U(null),G(null)},type:"button",children:"Close"})]}),q&&r.jsx("div",{className:"rounded border bg-red-50 p-3 text-sm text-red-800 border-red-200",children:q}),B&&r.jsx("div",{className:"rounded border bg-green-50 p-3 text-sm text-green-800 border-green-200",children:B}),(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,r.jsxs)("label",{className:"block text-sm",children:["Date",r.jsx("input",{className:"mt-1 w-full rounded border p-2",type:"date",value:v,onChange:e=>w(e.target.value)})]}),(0,r.jsxs)("label",{className:"block text-sm",children:["Start Time",r.jsx("select",{className:"mt-1 w-full rounded border p-2",value:A,onChange:e=>P(Number(e.target.value)),children:M.map(e=>(0,r.jsxs)("option",{value:e,children:[o(e),":00"]},e))})]}),(0,r.jsxs)("label",{className:"block text-sm",children:["Duration (hours)",r.jsx("input",{className:"mt-1 w-full rounded border p-2",type:"number",min:1,max:8,value:C,onChange:e=>D(Number(e.target.value))}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Must end by 17:00."})]}),(0,r.jsxs)("label",{className:"block text-sm",children:["Customer Name",r.jsx("input",{className:"mt-1 w-full rounded border p-2",value:_,onChange:e=>I(e.target.value)})]}),(0,r.jsxs)("label",{className:"block text-sm md:col-span-2",children:["Customer Phone",r.jsx("input",{className:"mt-1 w-full rounded border p-2",value:E,onChange:e=>T(e.target.value)})]})]}),r.jsx("button",{className:"rounded bg-gray-900 px-4 py-2 text-sm text-white disabled:opacity-60",disabled:$,onClick:H,type:"button",children:$?"Creating…":"Create Booking"})]})]})}},5141:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/Users/fuuentes/workspace/qroo_final/workspace/frontend/src/app/owner/bookings/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[380,301,411],()=>s(6701));module.exports=r})();
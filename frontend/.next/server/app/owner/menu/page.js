(()=>{var e={};e.id=54,e.ids=[54],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5761:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.Z,__next_app__:()=>m,originalPathname:()=>c,pages:()=>o,routeModule:()=>u,tree:()=>l}),s(6336),s(2697),s(5079),s(5866);var r=s(3191),a=s(8716),n=s(3315),i=s(5231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);s.d(t,d);let l=["",{children:["owner",{children:["menu",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,6336)),"/Users/fuuentes/workspace/qroo_final/workspace/frontend/src/app/owner/menu/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2697)),"/Users/fuuentes/workspace/qroo_final/workspace/frontend/src/app/owner/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,5079)),"/Users/fuuentes/workspace/qroo_final/workspace/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/fuuentes/workspace/qroo_final/workspace/frontend/src/app/owner/menu/page.tsx"],c="/owner/menu/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/owner/menu/page",pathname:"/owner/menu",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},5098:(e,t,s)=>{Promise.resolve().then(s.bind(s,6941))},6941:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(326),a=s(7577),n=s(4507),i=s(8069);function d(e){let t=Number(e);return Number.isFinite(t)?new Intl.NumberFormat(void 0,{maximumFractionDigits:2}).format(t):"0"}function l(){let[e,t]=(0,a.useState)(!0),[s,l]=(0,a.useState)(null),[o,c]=(0,a.useState)([]),[m,u]=(0,a.useState)([]),[x,p]=(0,a.useState)([]),[g,h]=(0,a.useState)(""),[b,y]=(0,a.useState)("ALL"),[f,v]=(0,a.useState)({}),[j,N]=(0,a.useState)(""),[w,k]=(0,a.useState)(""),[S,C]=(0,a.useState)(""),[P,_]=(0,a.useState)(!1);async function q(){l(null),t(!0);try{let[e,t,s]=await Promise.all([(0,i.S)("/menu-categories",{method:"GET"}).catch(()=>[]),(0,i.S)("/menu-items",{method:"GET"}),(0,i.S)("/desks",{method:"GET"})]),r=Array.isArray(e)?e:e?.categories||[],a=Array.isArray(t)?t:t?.menuItems||t?.items||[],n=Array.isArray(s)?s:s?.desks||[],d=r.map(e=>({id:String(e?.id??""),name:String(e?.name??"")})).filter(e=>!!(e.id&&e.name)),l=a.map(e=>({id:String(e?.id??""),name:String(e?.name??""),sku:String(e?.sku??""),price:Number(e?.price??0),categoryId:String(e?.categoryId??e?.category?.id??"")})).filter(e=>!!(e.id&&e.name)),o=n.map((e,t)=>({id:String(e?.id??""),name:String(e?.name??`Desk ${t+1}`)})).filter(e=>!!e.id);c(d),u(l),p(o),!g&&o.length&&h(o[0].id)}catch(e){l(e?.message||"Failed to load menu")}finally{t(!1)}}(0,a.useRef)("");let A=(0,a.useMemo)(()=>"ALL"===b?m:m.filter(e=>e.categoryId===b),[m,b]),E=(0,a.useMemo)(()=>{let e=new Map(m.map(e=>[e.id,e]));return Object.entries(f).map(([t,s])=>{let r=e.get(t);return r?{item:r,qty:s,total:r.price*s}:null}).filter(Boolean)},[f,m]),G=(0,a.useMemo)(()=>E.reduce((e,t)=>e+t.total,0),[E]),I=(0,a.useMemo)(()=>E.some(e=>"EXTRA_HOUR"===String(e.item.sku||"").toUpperCase()),[E]);function M(e){v(t=>({...t,[e]:(t[e]||0)+1}))}async function L(){if(l(null),!g)return l("Select a desk first.");if(!E.length)return l("Cart is empty.");if(I&&(!w.trim()||!S.trim()))return l("Customer name and phone are required for Extend time.");_(!0);try{await (0,i.S)("/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableId:g,notes:j||"",paymentMethod:"CASH",paymentStatus:"PENDING",customerName:I?w.trim():void 0,customerPhone:I?S.trim():void 0,items:E.map(e=>({menuItemId:e.item.id,quantity:e.qty}))})}),v({}),N(""),k(""),C(""),alert("Order created.")}catch(e){l(e?.message||"Order failed")}finally{_(!1)}}return e?r.jsx("div",{className:"text-sm text-gray-600",children:"Loading menu…"}):(0,r.jsxs)("div",{className:"space-y-5",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-2xl font-bold",children:"Menu"}),r.jsx("div",{className:"text-sm text-gray-600",children:"Click tiles or scan item QRs to add to cart."})]}),r.jsx("button",{className:"rounded border px-3 py-2 text-sm hover:bg-gray-50",onClick:q,type:"button",children:"Refresh"})]}),s&&r.jsx("div",{className:"rounded border bg-red-50 p-3 text-sm text-red-800 border-red-200",children:s}),(0,r.jsxs)("div",{className:"rounded border bg-white p-4 space-y-3",children:[(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,r.jsxs)("label",{className:"block text-sm",children:["Desk (required)",r.jsx("select",{className:"mt-1 w-full rounded border p-2",value:g,onChange:e=>h(e.target.value),children:x.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))})]}),(0,r.jsxs)("label",{className:"block text-sm",children:["Notes (optional)",r.jsx("input",{className:"mt-1 w-full rounded border p-2",value:j,onChange:e=>N(e.target.value)})]})]}),I&&(0,r.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,r.jsxs)("label",{className:"block text-sm",children:["Customer name (required for Extend time)",r.jsx("input",{className:"mt-1 w-full rounded border p-2",value:w,onChange:e=>k(e.target.value)})]}),(0,r.jsxs)("label",{className:"block text-sm",children:["Customer phone (required for Extend time)",r.jsx("input",{className:"mt-1 w-full rounded border p-2",value:S,onChange:e=>C(e.target.value)})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("div",{className:"text-sm font-semibold",children:"Categories"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[r.jsx("button",{type:"button",onClick:()=>y("ALL"),className:"rounded border px-3 py-2 text-sm "+("ALL"===b?"bg-gray-900 text-white":"hover:bg-gray-50"),children:"All"}),o.map(e=>r.jsx("button",{type:"button",onClick:()=>y(e.id),className:"rounded border px-3 py-2 text-sm "+(b===e.id?"bg-gray-900 text-white":"hover:bg-gray-50"),children:e.name},e.id))]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("div",{className:"text-sm font-semibold",children:"Items"}),(0,r.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[A.map(e=>{let t=`/owner/menu?add=${encodeURIComponent(e.id)}`;return(0,r.jsxs)("div",{className:"rounded border bg-white p-4",children:[(0,r.jsxs)("button",{type:"button",className:"w-full text-left hover:opacity-90",onClick:()=>M(e.id),children:[r.jsx("div",{className:"font-semibold",children:e.name}),(0,r.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:["SKU: ",e.sku]}),(0,r.jsxs)("div",{className:"text-sm mt-2",children:[d(e.price)," EGP"]}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Click to add"})]}),(0,r.jsxs)("div",{className:"mt-3 flex items-center gap-3",children:[r.jsx("div",{className:"rounded bg-gray-50 p-2",children:r.jsx(n.ZP,{value:t,size:80})}),(0,r.jsxs)("div",{className:"text-xs text-gray-600 break-all",children:["QR: ",r.jsx("span",{className:"font-mono",children:t})]})]})]},e.id)}),!A.length&&r.jsx("div",{className:"text-sm text-gray-600",children:"No items for this category."})]})]}),(0,r.jsxs)("div",{className:"rounded border bg-white p-4 space-y-2",children:[r.jsx("div",{className:"font-semibold",children:"Cart"}),E.length?(0,r.jsxs)("div",{className:"space-y-2",children:[E.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm",children:[e.item.name," \xd7 ",e.qty]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"text-sm",children:[d(e.total)," EGP"]}),r.jsx("button",{className:"rounded border px-2 py-1 text-sm hover:bg-gray-50",type:"button",onClick:()=>{var t;return t=e.item.id,void v(e=>{let s={...e},r=(s[t]||0)-1;return r<=0?delete s[t]:s[t]=r,s})},children:"-"}),r.jsx("button",{className:"rounded border px-2 py-1 text-sm hover:bg-gray-50",type:"button",onClick:()=>M(e.item.id),children:"+"})]})]},e.item.id)),(0,r.jsxs)("div",{className:"border-t pt-2 text-sm font-semibold",children:["Total: ",d(G)," EGP"]})]}):r.jsx("div",{className:"text-sm text-gray-600",children:"Cart is empty."}),r.jsx("button",{className:"rounded bg-gray-900 px-4 py-2 text-sm text-white disabled:opacity-60",disabled:P,onClick:L,type:"button",children:P?"Submitting…":"Create Order (Cash Pending)"})]})]})}},6336:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/Users/fuuentes/workspace/qroo_final/workspace/frontend/src/app/owner/menu/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[380,301,507,411],()=>s(5761));module.exports=r})();
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[850],{8193:function(e,t,r){Promise.resolve().then(r.bind(r,2129))},9376:function(e,t,r){"use strict";var a=r(5475);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},257:function(e,t,r){"use strict";var a,n;e.exports=(null==(a=r.g.process)?void 0:a.env)&&"object"==typeof(null==(n=r.g.process)?void 0:n.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,a,n=e.exports={};function s(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var l=[],u=!1,c=-1;function d(){u&&a&&(u=!1,a.length?l=a.concat(l):c=-1,l.length&&m())}function m(){if(!u){var e=o(d);u=!0;for(var t=l.length;t;){for(a=l,l=[];++c<t;)a&&a[c].run();c=-1,t=l.length}a=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new h(e,t)),1!==l.length||u||o(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function a(e){var n=r[e];if(void 0!==n)return n.exports;var s=r[e]={exports:{}},i=!0;try{t[e](s,s.exports,a),i=!1}finally{i&&delete r[e]}return s.exports}a.ab="//";var n=a(229);e.exports=n}()},2129:function(e,t,r){"use strict";r.d(t,{default:function(){return l}});var a=r(7437),n=r(2265),s=r(9376),i=r(1837);function o(e){let t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()}function l(e){var t;let{desks:r,menuItems:l,upcoming:u}=e,c=(0,s.useRouter)(),[d,m]=(0,n.useState)((null===(t=r[0])||void 0===t?void 0:t.id)||""),[h,p]=(0,n.useState)(""),[x,f]=(0,n.useState)(""),[g,b]=(0,n.useState)(()=>(function(e){let t=e=>String(e).padStart(2,"0"),r=e.getFullYear(),a=t(e.getMonth()+1),n=t(e.getDate()),s=t(e.getHours()),i=t(e.getMinutes());return"".concat(r,"-").concat(a,"-").concat(n,"T").concat(s,":").concat(i)})(new Date(Date.now()+36e5))),[v,y]=(0,n.useState)(1),[N,j]=(0,n.useState)(0),[w,S]=(0,n.useState)(0),[I,C]=(0,n.useState)(0),[T,k]=(0,n.useState)(!1),[P,E]=(0,n.useState)(null),L=(0,n.useMemo)(()=>{let e=new Map(l.map(e=>[e.sku,e.id]));return{extraHourId:e.get("001"),coffeeId:e.get("002"),teaId:e.get("003"),pastryId:e.get("004")}},[l]);async function D(){if(E(null),!d)return E("Pick a desk.");if(!L.extraHourId)return E("Missing menu item SKU 001 (Extra hour).");let e=new Date(g);if(Number.isNaN(e.getTime()))return E("Pick a valid start time.");if(!Number.isFinite(v)||v<=0)return E("Hours must be at least 1.");let t=[{menuItemId:L.extraHourId,quantity:Math.floor(v)}];N>0&&L.coffeeId&&t.push({menuItemId:L.coffeeId,quantity:Math.floor(N)}),w>0&&L.teaId&&t.push({menuItemId:L.teaId,quantity:Math.floor(w)}),I>0&&L.pastryId&&t.push({menuItemId:L.pastryId,quantity:Math.floor(I)}),k(!0);try{await (0,i.S)("/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableId:d,customerName:h||void 0,customerPhone:x||void 0,startAt:e.toISOString(),items:t})}),p(""),f(""),y(1),j(0),S(0),C(0),c.refresh()}catch(e){E((null==e?void 0:e.message)||"Failed to create booking.")}finally{k(!1)}}async function A(e,t){E(null),k(!0);try{await (0,i.S)("/orders/".concat(e,"/status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})}),c.refresh()}catch(e){E((null==e?void 0:e.message)||"Failed to update status.")}finally{k(!1)}}return(0,a.jsxs)("div",{className:"mt-6 grid gap-6 lg:grid-cols-2",children:[(0,a.jsxs)("div",{className:"rounded border bg-white p-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Create a booking"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"This reserves a desk for a future time slot. If the desk is already booked, you’ll get an error."}),P&&(0,a.jsx)("div",{className:"mt-3 rounded border border-red-200 bg-red-50 p-2 text-sm text-red-700",children:P}),(0,a.jsxs)("div",{className:"mt-4 grid gap-2",children:[(0,a.jsx)("label",{className:"text-xs text-gray-600",children:"Desk"}),(0,a.jsx)("select",{className:"rounded border p-2",value:d,onChange:e=>m(e.target.value),children:r.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name,e.laptopSerial?" (Laptop ".concat(e.laptopSerial,")"):""]},e.id))}),(0,a.jsx)("label",{className:"mt-2 text-xs text-gray-600",children:"Start time"}),(0,a.jsx)("input",{type:"datetime-local",className:"rounded border p-2",value:g,onChange:e=>b(e.target.value)}),(0,a.jsxs)("div",{className:"mt-2 grid gap-2 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-600",children:"Hours (SKU 001)"}),(0,a.jsx)("input",{type:"number",min:1,className:"w-full rounded border p-2",value:v,onChange:e=>y(parseInt(e.target.value||"1",10))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-600",children:"Coffee qty (SKU 002)"}),(0,a.jsx)("input",{type:"number",min:0,className:"w-full rounded border p-2",value:N,onChange:e=>j(parseInt(e.target.value||"0",10))}),(0,a.jsx)("div",{className:"mt-1 text-[11px] text-gray-500",children:"Free coffee will be applied automatically (1 per paid hour)."})]})]}),(0,a.jsxs)("div",{className:"grid gap-2 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-600",children:"Tea qty (SKU 003)"}),(0,a.jsx)("input",{type:"number",min:0,className:"w-full rounded border p-2",value:w,onChange:e=>S(parseInt(e.target.value||"0",10))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-xs text-gray-600",children:"Pastry qty (SKU 004)"}),(0,a.jsx)("input",{type:"number",min:0,className:"w-full rounded border p-2",value:I,onChange:e=>C(parseInt(e.target.value||"0",10))})]})]}),(0,a.jsx)("label",{className:"mt-2 text-xs text-gray-600",children:"Customer name (optional)"}),(0,a.jsx)("input",{className:"rounded border p-2",value:h,onChange:e=>p(e.target.value)}),(0,a.jsx)("label",{className:"text-xs text-gray-600",children:"Phone (optional)"}),(0,a.jsx)("input",{className:"rounded border p-2",value:x,onChange:e=>f(e.target.value)})]}),(0,a.jsx)("button",{className:"mt-4 w-full rounded bg-blue-600 px-4 py-2 font-semibold text-white disabled:opacity-60",disabled:T,onClick:D,type:"button",children:T?"Saving...":"Create booking"})]}),(0,a.jsxs)("div",{className:"rounded border bg-white p-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Upcoming bookings"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"Future start times (not cancelled / completed)."}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[(u||[]).map(e=>{var t,r;return(0,a.jsxs)("div",{className:"rounded border bg-white p-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:(null===(t=e.table)||void 0===t?void 0:t.name)||"Desk"}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:e.startAt&&e.endAt?(0,a.jsxs)("span",{children:[o(e.startAt)," → ",o(e.endAt)]}):(0,a.jsx)("span",{children:new Date(e.createdAt).toLocaleString()})}),(e.customerName||e.customerPhone)&&(0,a.jsxs)("div",{className:"mt-1 text-sm text-gray-700",children:[e.customerName?(0,a.jsx)("span",{children:e.customerName}):null,e.customerPhone?(0,a.jsx)("span",{className:"ml-2 text-gray-500",children:e.customerPhone}):null]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-lg font-bold",children:(r=e.total,new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(r)+" EGP")}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:["Status: ",e.status]})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,a.jsx)("button",{className:"rounded border px-3 py-1 text-sm disabled:opacity-60",disabled:T,onClick:()=>A(e.id,"CONFIRMED"),type:"button",children:"Confirm"}),(0,a.jsx)("button",{className:"rounded bg-green-600 px-3 py-1 text-sm text-white disabled:opacity-60",disabled:T,onClick:()=>A(e.id,"COMPLETED"),type:"button",children:"Completed"}),(0,a.jsx)("button",{className:"rounded bg-gray-700 px-3 py-1 text-sm text-white disabled:opacity-60",disabled:T,onClick:()=>A(e.id,"CANCELLED"),type:"button",children:"Cancel"})]})]},e.id)}),(!u||0===u.length)&&(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"No upcoming bookings."})]})]})]})}},1837:function(e,t,r){"use strict";r.d(t,{S:function(){return n}});var a=r(257);async function n(e,t){let r=a.env.NEXT_PUBLIC_API_URL||"http://localhost:3001",n=await fetch("".concat(r).concat(e),{...t,credentials:"include"});if(!n.ok)throw Error(await n.text()||"Request failed: ".concat(n.status));return(n.headers.get("content-type")||"").includes("application/json")?n.json():n.text()}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=8193)}),_N_E=e.O()}]);